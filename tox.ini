[tox]
minversion = 2.0
skipsdist = True
envlist = py34, py27, pep8

[testenv]
# Note the hash seed is set to 0 until cinder can be tested with a
# random hash seed successfully.
setenv = VIRTUAL_ENV = {envdir}
    PYTHONHASHSEED = 0
usedevelop = True
# install_command = pip install
# -c{env:UPPER_CONSTRAINTS_FILE:https://git.openstack.org/cgit/openstack/requirements/plain/upper-constraints.txt}
# {opts} {packages}
install_command = pip install - c{env: UPPER_CONSTRAINTS_FILE: https: // git.openstack.org / cgit / openstack / requirements / plain / upper - constraints.txt} {opts} {packages}

deps = -r{toxinidir} / test - requirements.txt
    oslo.versionedobjects[fixtures]


# By default ostestr will set concurrency
# to ncpu, to specify something else use
# the concurrency=<n> option.
# call ie: 'tox -epy27 -- --concurrency=4'
commands =
    find . -type f - name "*.pyc" - delete
    ostestr {posargs}

whitelist_externals =
    bash
    find
passenv = *_proxy * _PROXY


[testenv:functional]
setenv =
    OS_TEST_PATH = . / workloadmgr / tests / functional

[testenv:pep8]
commands =
    flake8 {posargs} .
    # Check that .po and .pot files are valid:
    bash - c "find cinder -type f -regex '.*\.pot?' -print0|xargs -0 -n 1 msgfmt --check-format -o /dev/null"
    {toxinidir} / tools / check_exec.py {toxinidir} / workloadmgr

[testenv:fast8]
# Use same environment directory as pep8 env to save space and install time
envdir = {toxworkdir} / pep8
commands =
    {toxinidir} / tools / fast8.sh

[testenv:pylint]
deps = -r{toxinidir} / requirements.txt
    pylint == 0.26.0
commands = bash tools / lintstack.sh

[testenv:venv]
# NOTE(jaegerandi): This target does not use constraints because
# upstream infra does not yet support it. Once that's fixed, we can
# drop the install_command.
install_command = pip install - U - -force - reinstall {opts} {packages}
commands = {posargs}

[flake8]
# Following checks are ignored on purpose.
#
# E251 unexpected spaces around keyword / parameter equals
# reason: no improvement in readability
ignore = E251
exclude = .git, .venv, .tox, dist, tools, doc, *egg, build
max - complexity = 30

[hacking]
local - check - factory = workloadmgr.hacking.checks.factory
import_exceptions = workloadmgr.i18n
